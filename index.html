<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xBloom Recipes Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        :root{ --gr:linear-gradient(135deg,#00A896,#4A90E2); --bg:#0A0A0A; --card:#1A1A1A; --up:#252525; --br:#2A2A2A; --t1:#fff; --t2:#A0A0A0; --ta:#00A896 }
        body{font-family:'Cairo',sans-serif;background:var(--bg);color:var(--t1);padding:12px;min-height:100vh}
        .wrap{max-width:1400px;margin:0 auto}
        header{text-align:center;padding:20px 15px;margin-bottom:20px;background:rgba(43,43,43,0.9);border-radius:16px;border:1px solid var(--br);position:relative}
        header::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--gr);border-radius:16px 16px 0 0}
        h1{font-size:clamp(1.7em,5vw,2.8em);font-weight:900;background:var(--gr);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
        .btn{padding:9px 18px;border-radius:10px;border:none;font-size:13px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:5px;transition:.2s; text-decoration:none; justify-content:center;}
        .bp{background:var(--gr);color:#fff}
        .bd{background:linear-gradient(135deg,#f5576c,#f093fb);color:#fff}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(min(100%,290px),1fr));gap:14px;margin-bottom:16px}
        .card{background:var(--card);border-radius:12px;padding:17px;border:1px solid var(--br);position:relative; transition: .3s;}
        .card:hover{transform:translateY(-4px); border-color: var(--ta);}
        .admin-box { background: var(--up); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; border: 1px dashed var(--ta); }
        .ov{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:1000;padding:14px;}
        .ov.open{display:flex;}
        .modal{background:var(--card);border-radius:14px;padding:20px;max-width:480px;width:100%;border:1px solid var(--br); max-height: 90vh; overflow-y: auto;}
        .fi,.fs{width:100%;padding:10px;border:2px solid var(--br);border-radius:9px;background:var(--up);color:var(--t1);margin-bottom:12px; font-family: inherit;}
    </style>
</head>
<body>

<div class="wrap">
    <header>
        <h1>â˜• Xbloom Recipes</h1>
        <p style="color:var(--t2); margin-bottom:15px;">Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ - xBloom Hub</p>
        <button class="btn bp" onclick="document.getElementById('addModal').classList.add('open')">Ø¥Ø¶Ø§ÙØ© ÙˆØµÙØ© Ø¬Ø¯ÙŠØ¯Ø© â•</button>
    </header>

    <div class="admin-box">
        <p style="font-size: 0.8em; color: var(--t2); margin-bottom: 10px;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
        <button class="btn" style="background:#444; color:white;" id="legacyBtn">Ø±ÙØ¹ ÙƒØ§ÙØ© Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ğŸ“¦</button>
    </div>

    <div class="grid" id="grid"></div>

    <footer style="text-align:center; padding:40px; color:var(--t2);">
        <p id="fcount">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        <p style="margin-top:10px; font-size:0.8em;">ABDULELAH ALSUFAYAN 2026</p>
    </footer>
</div>

<div class="ov" id="addModal">
    <div class="modal">
        <h3>Ø¥Ø¶Ø§ÙØ© ÙˆØµÙØ©</h3>
        <form id="recipeForm">
            <input type="text" id="rName" class="fi" required placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØµÙØ©">
            <input type="text" id="rAuthor" class="fi" placeholder="Ø§Ù„Ù…Ø¤Ù„Ù">
            <input type="text" id="rDose" class="fi" required placeholder="Ø§Ù„Ø¬Ø±Ø¹Ø©">
            <input type="url" id="rLink" class="fi" required placeholder="Ø±Ø§Ø¨Ø· xBloom">
            <div style="display:flex; gap:10px;">
                <button type="submit" class="btn bp" style="flex:2">Ù†Ø´Ø±</button>
                <button type="button" class="btn" onclick="document.getElementById('addModal').classList.remove('open')" style="background:#444; color:white; flex:1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </form>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDq370Yy4W-TfbyFL5rt4y3h3ngajJVIrE",
        authDomain: "xbloom-recipes-hub.firebaseapp.com",
        projectId: "xbloom-recipes-hub",
        storageBucket: "xbloom-recipes-hub.firebasestorage.app",
        messagingSenderId: "210276765536",
        appId: "1:210276765536:web:99de5207eaeb934828d805",
        databaseURL: "https://xbloom-recipes-hub-default-rtdb.europe-west1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const recipesRef = ref(db, 'recipes');

    // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØµÙØ§Øª
    onValue(recipesRef, (snapshot) => {
        const grid = document.getElementById('grid');
        const count = document.getElementById('fcount');
        grid.innerHTML = '';
        const data = snapshot.val();
        if (data) {
            const list = Object.entries(data).reverse();
            count.innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØµÙØ§Øª: ${list.length}`;
            list.forEach(([id, r]) => {
                grid.innerHTML += `
                    <div class="card">
                        <h3>${r.name}</h3>
                        <p style="color:var(--ta); font-size:0.85em;">Ø¨ÙˆØ§Ø³Ø·Ø©: ${r.author || 'Ù…Ø´Ø§Ø±Ùƒ'}</p>
                        <div style="margin-top:15px; display:flex; gap:5px;">
                            <a href="${r.link}" target="_blank" class="btn bp" style="flex:3">ÙØªØ­ ğŸ”—</a>
                            <button onclick="window.del('${id}')" class="btn bd" style="flex:1">ğŸ—‘ï¸</button>
                        </div>
                    </div>`;
            });
        }
    });

    window.del = (id) => { if(confirm("Ø­Ø°ÙØŸ")) remove(ref(db, `recipes/${id}`)); };

    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù‚Ø¯ÙŠÙ…
    document.getElementById('legacyBtn').addEventListener('click', () => {
        const legacy = [
            {"name": "ÙˆØµÙØ© Ø¨Ø§Ø±Ø¯Ù‡ 24 Ø¬Ø±Ø§Ù… Ù‚Ù‡ÙˆØ©", "author": "mf", "brewer": "Other", "dose": "24g", "link": "https://share-h5.xbloom.com/?id=ZZxY4cY1PPjQ2M3HyuQQkg%3D%3D"},
            {"name": "Abla | Colombia 20G", "author": "Abdulrahman alnasser", "brewer": "Other", "dose": "20g", "link": "https://share-h5.xbloom.com/?id=Zv1nKEbBLN%2BB309uAYN9xg%3D%3D"}
            /* Ø§Ù„ØµÙ‚ Ù‡Ù†Ø§ Ø¨Ù‚ÙŠØ© Ø§Ù„Ù€ 214 ÙˆØµÙØ© Ù…Ù† Ø§Ù„Ù€ INIT Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø¶Ù…Ø§Ù† Ø±ÙØ¹Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        ];
        legacy.forEach(r => push(recipesRef, { ...r, createdAt: Date.now() }));
        alert("ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!");
    });

    // ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    document.getElementById('recipeForm').addEventListener('submit', (e) => {
        e.preventDefault();
        push(recipesRef, {
            name: document.getElementById('rName').value,
            author: document.getElementById('rAuthor').value,
            dose: document.getElementById('rDose').value,
            link: document.getElementById('rLink').value,
            createdAt: Date.now()
        }).then(() => {
            document.getElementById('addModal').classList.remove('open');
            document.getElementById('recipeForm').reset();
        });
    });
</script>
</body>
</html>